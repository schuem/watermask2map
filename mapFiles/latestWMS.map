MAP
	NAME "wmstest"
	  EXTENT -40.5 -7.0 -37.5 -4.5
	  SIZE 800 600
	
	  PROJECTION  "init=epsg:4326"
	END
	
	WEB
		HEADER	"../templates/latest_web_header.html"
		FOOTER	"../templates/latest_web_footer.html"
		METADATA
			"wms_title"						"latest watermasks WMS Demo"
			"wms_enable_request" 			"*"
			"ows_enable_request"			"*"
			"ows_include_items"     		"all"
			"wms_onlineresource"			"http://141.89.96.182/latestwms&"
			"wms_srs"						"EPSG:4326 EPSG:3857"
			"wms_feature_info_mime_type" 	"text/html"
#			"wms_format" 					"image/png"
		END
    		#TEMPPATH "/tmp/"
    		IMAGEPATH "/var/www/html/"
	END

  LAYER
    NAME 		watermask
    EXTENT 		-40.5 -7.0 -37.5 -4.5
    STATUS 		ON
    TYPE 		POLYGON
    CONNECTIONTYPE 	POSTGIS
    CONNECTION 		"host=localhost dbname=watermasks user=readonly password=read_only"
    DATA 			"geom from (select distinct on (id_jrc) id_jrc, ingestion_time, area, geom, id from demo_geom where case when area <> 0 then wmxjrc_area/area > 0.2 else true end and ingestion_time > '2020-11-01' order by id_jrc, ingestion_time desc) as subquery using unique id using srid=4326"
    PROCESSING "CLOSE_CONNECTION=DEFER"

    CLASS
      NAME "watermask"
      STYLE
        COLOR 0 0 0 
      END
    END 

  END


  LAYER
    NAME 		JRC-Global-Water-Bodies
    EXTENT 		-40.5 -7.0 -37.5 -4.5
    STATUS 		ON
    TYPE 		POLYGON
    CONNECTIONTYPE 	POSTGIS
    CONNECTION 		"host=localhost dbname=watermasks user=readonly password=read_only"
    DATA 			"geom from jrc_demo using unique id_jrc using srid=4326"
    PROCESSING "CLOSE_CONNECTION=DEFER"
    
    CLASS
      NAME "JRC Global Water Bodies (static)"
      STYLE
      	OUTLINECOLOR 255 69 0
      	WIDTH 1
      END
    END
  END

END
		
